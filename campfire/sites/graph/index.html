<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>Sheet Data & Chart Download</title>
    <style>
      body { font-family: sans-serif; text-align: center; padding: 20px; }
      #ss-data { font-size: 24px; font-weight: bold; margin-bottom: 20px; display: block; }
      .btn-download {
        padding: 12px 24px;
        font-size: 16px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none;
      }
      .btn-download:hover { background-color: #218838; }
      iframe { margin-top: 20px; border: 1px solid #ccc; }
    </style>
  </head>
  <body>

    <div id="ss-data">読み込み中...</div>

    <iframe width="600" height="371" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQOPyO9vkqXun7C6VzpZ1CVKBm2Cu-6AoETfRW3Pp7gB4iE0t-_jaXofZH_Yd6qdDzlsGqZFbz85_eX/pubchart?oid=626494851&amp;format=interactive" frameborder="0"></iframe>

    <br><br>

    <button type="button" class="btn-download" onclick="downloadChart()">グラフをダウンロード</button>

    <script>
      // 1. スプレッドシートからのデータ取得 (Google Sheets API)
      (async function() {
        const SPREADSHEET_ID = '1ebgK72Arbbu8l-BKPIQ0so19oNkNeab8658ejo7PI7s'; 
        const API_KEY = 'AIzaSyDNJZGMkK_kVrNr00NMXKszGVUs5iWxeKY'; 
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/シート1!M1414?key=${API_KEY}`;
        try {
          const res = await fetch(url);
          const data = await res.json();
          document.getElementById("ss-data").innerText = data.values[0][0];
        } catch (e) {
          document.getElementById("ss-data").innerText = "Error";
        }
      })();

      // 2. ダウンロード処理
      function downloadChart() {
        const imgUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQOPyO9vkqXun7C6VzpZ1CVKBm2Cu-6AoETfRW3Pp7gB4iE0t-_jaXofZH_Yd6qdDzlsGqZFbz85_eX/pubchart?oid=626494851&format=image";
        
        // 一時的なリンクを作成
        const link = document.createElement('a');
        link.href = imgUrl;
        link.download = 'chart.png'; // ダウンロード時のファイル名
        
        // リンクをドキュメントに追加（一部のブラウザで必要）
        document.body.appendChild(link);
        
        // 強制クリック
        link.click();
        
        // 後片付け
        document.body.removeChild(link);
      }
    </script>
  </body>
</html>
